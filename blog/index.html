---
layout: default
title: Blog
pagination:
  enabled: true
---

<section class="blog-section">
    <div class="section-header">
        <div class="search-wrapper">
            <input type="text" id="search-input" placeholder="üîç Search articles..." aria-label="Search">
            
            <div class="view-toggle">
                <button id="grid-view-btn" class="toggle-btn active" title="Grid View">
                    <span>Grid View</span>
                </button>
                <button id="list-view-btn" class="toggle-btn" title="List View">
                    <span>List View</span>
                </button>
            </div>
        </div>

        <div class="tags-chips-wrapper">
            <div class="tags-chips-container" id="tags-list">
                <span class="filter-tag active" data-tag="all">All Topics</span>
                
                {% assign all_tags = "" | split: "," %}
                {% for post in site.posts %}
                  {% for tag in post.tags %}
                    {% capture tag_norm %}{{ tag | downcase }}{% endcapture %}
                    {% unless all_tags contains tag_norm %}
                      {% assign all_tags = all_tags | push: tag_norm %}
                    {% endunless %}
                  {% endfor %}
                {% endfor %}
                {% assign sorted_tags = all_tags | sort %}
                
                {% for tag in sorted_tags %}
                {% assign tag_display = "" %}
                {% assign tag_count = 0 %}
                {% for post in site.posts %}
                    {% assign found_in_post = false %}
                    {% for t in post.tags %}
                        {% capture t_norm %}{{ t | downcase }}{% endcapture %}
                        {% if t_norm == tag %}
                            {% assign tag_display = t %}
                            {% assign found_in_post = true %}
                        {% endif %}
                    {% endfor %}
                    {% if found_in_post %}
                        {% assign tag_count = tag_count | plus: 1 %}
                    {% endif %}
                {% endfor %}
                <span class="filter-tag" data-tag="{{ tag }}">
                    {{ tag_display }} <span class="tag-count">{{ tag_count }}</span>
                </span>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <div class="posts-grid" id="posts-grid">
        <!-- Posts will be loaded here via JavaScript -->
    </div>

    <!-- Loading Indicator -->
    <div id="loading-sentinel" style="height: 20px; margin: 2rem 0; text-align: center;">
        <div class="loading-spinner"></div>
    </div>
</section>

<style>
.loading-spinner {
    display: inline-block;
    width: 30px;
    height: 30px;
    border: 3px solid var(--bg-hover);
    border-radius: 50%;
    border-top-color: var(--primary);
    animation: spin 1s ease-in-out infinite;
    opacity: 0;
    transition: opacity 0.3s ease;
}
.loading-spinner.visible {
    opacity: 1;
}
@keyframes spin {
    to { transform: rotate(360deg); }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-input');
    const grid = document.getElementById('posts-grid');
    const filterTags = document.querySelectorAll('.filter-tag');
    const gridBtn = document.getElementById('grid-view-btn');
    const listBtn = document.getElementById('list-view-btn');
    const sentinel = document.getElementById('loading-sentinel');
    const spinner = sentinel.querySelector('.loading-spinner');
    
    let allPosts = [];
    let filteredPosts = [];
    let displayedPosts = [];
    let currentCategory = 'all';
    let postsPerPage = 6;
    let currentIndex = 0;

    // View Switching Logic
    function setView(view) {
        if (view === 'list') {
            grid.classList.add('list-view');
            listBtn.classList.add('active');
            gridBtn.classList.remove('active');
        } else {
            grid.classList.remove('list-view');
            gridBtn.classList.add('active');
            listBtn.classList.remove('active');
        }
        localStorage.setItem('blog-view', view);
    }

    gridBtn.addEventListener('click', () => setView('grid'));
    listBtn.addEventListener('click', () => setView('list'));

    // Initialize View from LocalStorage
    const savedView = localStorage.getItem('blog-view') || 'grid';
    setView(savedView);

    // Horizontal scroll for tags using mouse wheel
    const tagsContainer = document.getElementById('tags-list');
    if (tagsContainer) {
        tagsContainer.addEventListener('wheel', (e) => {
            if (e.deltaY !== 0) {
                e.preventDefault();
                tagsContainer.scrollLeft += e.deltaY;
            }
        });
    }

    // Fetch all posts from search.json
    fetch('{{ "/search.json" | relative_url }}')
        .then(response => response.json())
        .then(data => {
            allPosts = data;
            
            // Check for tag in URL
            const urlParams = new URLSearchParams(window.location.search);
            const urlTag = urlParams.get('tag');
            
            if (urlTag) {
                currentCategory = urlTag.toLowerCase();
                // Set active class on corresponding tag button
                filterTags.forEach(t => {
                    if (t.dataset.tag.toLowerCase() === currentCategory) {
                        t.classList.add('active');
                    } else {
                        t.classList.remove('active');
                    }
                });
                filterPosts(searchInput.value.toLowerCase(), currentCategory);
            } else {
                filteredPosts = [...allPosts];
                loadMorePosts(); // Initial load
            }
            
            setupIntersectionObserver();
        });

    function loadMorePosts() {
        if (currentIndex >= filteredPosts.length) {
            spinner.classList.remove('visible');
            return;
        }

        spinner.classList.add('visible');
        
        const nextBatch = filteredPosts.slice(currentIndex, currentIndex + postsPerPage);
        currentIndex += postsPerPage;

        renderPostsBatch(nextBatch);
        
        if (currentIndex >= filteredPosts.length) {
            spinner.classList.remove('visible');
        }
    }

    function renderPostsBatch(batch) {
        const html = batch.map(post => `
            <article class="post-card" style="animation: fadeIn 0.6s ease-out forwards;">
                <div class="post-meta">
                    <span class="post-date">${post.date}</span>
                    <span class="read-time">‚è±Ô∏è ${post.read_time}</span>
                    ${post.tags ? `<span class="post-tag">${post.tags.split(',')[0].trim()}</span>` : ''}
                </div>
                <h3><a href="${post.url}">${post.title}</a></h3>
                <p class="post-excerpt">${post.excerpt}</p>
                <a href="${post.url}" class="read-more">Read Article ‚ûú</a>
            </article>
        `).join('');
        
        grid.insertAdjacentHTML('beforeend', html);
    }

    function setupIntersectionObserver() {
        const observer = new IntersectionObserver((entries) => {
            if (entries[0].isIntersecting && currentIndex < filteredPosts.length) {
                loadMorePosts();
            }
        }, {
            rootMargin: '100px'
        });

        observer.observe(sentinel);
    }

    searchInput.addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        filterPosts(term, currentCategory);
    });

    filterTags.forEach(tag => {
        tag.addEventListener('click', () => {
            filterTags.forEach(t => t.classList.remove('active'));
            tag.classList.add('active');
            currentCategory = tag.dataset.tag.toLowerCase();
            
            // Update URL without reloading
            const url = new URL(window.location);
            if (currentCategory === 'all') {
                url.searchParams.delete('tag');
            } else {
                url.searchParams.set('tag', tag.dataset.tag);
            }
            window.history.pushState({}, '', url);

            filterPosts(searchInput.value.toLowerCase(), currentCategory);
        });
    });

    function filterPosts(term, category) {
        const normalizedCategory = category ? category.toLowerCase() : 'all';
        filteredPosts = allPosts.filter(post => {
            const matchesSearch = !term || 
                                  post.title.toLowerCase().includes(term) || 
                                  post.tags.toLowerCase().includes(term) ||
                                  post.excerpt.toLowerCase().includes(term);
            const postTags = post.tags ? post.tags.toLowerCase() : '';
            const matchesCategory = normalizedCategory === 'all' || postTags.includes(normalizedCategory);
            
            return matchesSearch && matchesCategory;
        });

        // Reset grid and index
        grid.innerHTML = '';
        currentIndex = 0;
        
        if (filteredPosts.length === 0) {
            grid.innerHTML = '<div class="no-results"><p>No articles found matching your criteria.</p><button class="btn btn-outline mt-lg" id="clear-search">Clear Search</button></div>';
            document.getElementById('clear-search').addEventListener('click', () => {
                searchInput.value = '';
                filterTags[0].click(); // Reset to 'All'
            });
            spinner.classList.remove('visible');
        } else {
            loadMorePosts();
        }
    }
});
</script>
