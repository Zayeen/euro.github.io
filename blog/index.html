---
layout: default
title: Blog
pagination:
  enabled: true
---

<section class="blog-section">
    <div class="blog-container">
        <main class="blog-main">
            <div class="section-header">
                <div class="search-wrapper">
                    <input type="text" id="search-input" placeholder="üîç Search articles..." aria-label="Search">
                    
                    <div class="view-toggle">
                        <button id="grid-view-btn" class="toggle-btn active" title="Grid View">
                            <span>Grid View</span>
                        </button>
                        <button id="list-view-btn" class="toggle-btn" title="List View">
                            <span>List View</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="posts-grid" id="posts-grid">
                <!-- Posts will be loaded here via JavaScript -->
            </div>

            <!-- Loading Indicator -->
            <div id="loading-sentinel" style="height: 20px; margin: 2rem 0; text-align: center;">
                <div class="loading-spinner"></div>
            </div>
        </main>

        <aside class="blog-sidebar">
            <div class="sidebar-widget">
                <h3>Explore Tags</h3>
                <div class="tags-cloud">
                    <span class="filter-tag active" data-tag="all">All Posts</span>
                    {% assign all_tags = "" | split: "," %}
                    {% for post in site.posts %}
                      {% for tag in post.tags %}
                        {% capture tag_norm %}{{ tag | downcase }}{% endcapture %}
                        {% unless all_tags contains tag_norm %}
                          {% assign all_tags = all_tags | push: tag_norm %}
                        {% endunless %}
                      {% endfor %}
                    {% endfor %}
                    {% assign sorted_tags = all_tags | sort %}
                    
                    <div class="tags-list" id="tags-list">
                        {% for tag in sorted_tags %}
                        {% assign tag_display = "" %}
                        {% for post in site.posts %}
                            {% for t in post.tags %}
                                {% capture t_norm %}{{ t | downcase }}{% endcapture %}
                                {% if t_norm == tag %}
                                    {% assign tag_display = t %}
                                    {% break %}
                                {% endif %}
                            {% endfor %}
                            {% if tag_display != "" %}{% break %}{% endif %}
                        {% endfor %}
                        <span class="filter-tag" data-tag="{{ tag }}">#{{ tag_display }}</span>
                        {% endfor %}
                    </div>
                    {% if sorted_tags.size > 15 %}
                    <button id="show-all-tags" class="btn-text">Show All Tags</button>
                    {% endif %}
                </div>
            </div>

            <div class="sidebar-widget">
                <h3>Newsletter</h3>
                <p>Get the latest updates from the lab.</p>
                <div class="newsletter-mini">
                    <input type="email" placeholder="Email address">
                    <button class="btn btn-sm">Join</button>
                </div>
            </div>
        </aside>
    </div>
</section>

<style>
.loading-spinner {
    display: inline-block;
    width: 30px;
    height: 30px;
    border: 3px solid var(--bg-hover);
    border-radius: 50%;
    border-top-color: var(--primary);
    animation: spin 1s ease-in-out infinite;
    opacity: 0;
    transition: opacity 0.3s ease;
}
.loading-spinner.visible {
    opacity: 1;
}
@keyframes spin {
    to { transform: rotate(360deg); }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-input');
    const grid = document.getElementById('posts-grid');
    const filterTags = document.querySelectorAll('.filter-tag');
    const gridBtn = document.getElementById('grid-view-btn');
    const listBtn = document.getElementById('list-view-btn');
    const sentinel = document.getElementById('loading-sentinel');
    const spinner = sentinel.querySelector('.loading-spinner');
    
    let allPosts = [];
    let filteredPosts = [];
    let displayedPosts = [];
    let currentCategory = 'all';
    let postsPerPage = 6;
    let currentIndex = 0;

    // View Switching Logic
    function setView(view) {
        if (view === 'list') {
            grid.classList.add('list-view');
            listBtn.classList.add('active');
            gridBtn.classList.remove('active');
        } else {
            grid.classList.remove('list-view');
            gridBtn.classList.add('active');
            listBtn.classList.remove('active');
        }
        localStorage.setItem('blog-view', view);
    }

    gridBtn.addEventListener('click', () => setView('grid'));
    listBtn.addEventListener('click', () => setView('list'));

    // Initialize View from LocalStorage
    const savedView = localStorage.getItem('blog-view') || 'grid';
    setView(savedView);

    // Show/Hide Tags logic
    const tagsList = document.getElementById('tags-list');
    const showAllBtn = document.getElementById('show-all-tags');
    if (showAllBtn && tagsList) {
        const allTags = tagsList.querySelectorAll('.filter-tag');
        const limit = 15;
        
        if (allTags.length > limit) {
            allTags.forEach((tag, index) => {
                if (index >= limit) tag.style.display = 'none';
            });
            
            showAllBtn.addEventListener('click', () => {
                const isExpanded = showAllBtn.textContent === 'Show Less';
                allTags.forEach((tag, index) => {
                    if (index >= limit) tag.style.display = isExpanded ? 'none' : 'inline-block';
                });
                showAllBtn.textContent = isExpanded ? 'Show All Tags' : 'Show Less';
            });
        }
    }

    // Fetch all posts from search.json
    fetch('{{ "/search.json" | relative_url }}')
        .then(response => response.json())
        .then(data => {
            allPosts = data;
            
            // Check for tag in URL
            const urlParams = new URLSearchParams(window.location.search);
            const urlTag = urlParams.get('tag');
            
            if (urlTag) {
                currentCategory = urlTag.toLowerCase();
                // Set active class on corresponding tag button
                filterTags.forEach(t => {
                    if (t.dataset.tag.toLowerCase() === currentCategory) {
                        t.classList.add('active');
                    } else {
                        t.classList.remove('active');
                    }
                });
                filterPosts(searchInput.value.toLowerCase(), currentCategory);
            } else {
                filteredPosts = [...allPosts];
                loadMorePosts(); // Initial load
            }
            
            setupIntersectionObserver();
        });

    function loadMorePosts() {
        if (currentIndex >= filteredPosts.length) {
            spinner.classList.remove('visible');
            return;
        }

        spinner.classList.add('visible');
        
        const nextBatch = filteredPosts.slice(currentIndex, currentIndex + postsPerPage);
        currentIndex += postsPerPage;

        renderPostsBatch(nextBatch);
        
        if (currentIndex >= filteredPosts.length) {
            spinner.classList.remove('visible');
        }
    }

    function renderPostsBatch(batch) {
        const html = batch.map(post => `
            <article class="post-card" style="animation: fadeIn 0.6s ease-out forwards;">
                <div class="post-meta">
                    <span class="post-date">${post.date}</span>
                    <span class="read-time">‚è±Ô∏è ${post.read_time}</span>
                    ${post.tags ? `<span class="post-tag">${post.tags.split(',')[0].trim()}</span>` : ''}
                </div>
                <h3><a href="${post.url}">${post.title}</a></h3>
                <p class="post-excerpt">${post.excerpt}</p>
                <a href="${post.url}" class="read-more">Read Article ‚ûú</a>
            </article>
        `).join('');
        
        grid.insertAdjacentHTML('beforeend', html);
    }

    function setupIntersectionObserver() {
        const observer = new IntersectionObserver((entries) => {
            if (entries[0].isIntersecting && currentIndex < filteredPosts.length) {
                loadMorePosts();
            }
        }, {
            rootMargin: '100px'
        });

        observer.observe(sentinel);
    }

    searchInput.addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        filterPosts(term, currentCategory);
    });

    filterTags.forEach(tag => {
        tag.addEventListener('click', () => {
            filterTags.forEach(t => t.classList.remove('active'));
            tag.classList.add('active');
            currentCategory = tag.dataset.tag.toLowerCase();
            
            // Update URL without reloading
            const url = new URL(window.location);
            if (currentCategory === 'all') {
                url.searchParams.delete('tag');
            } else {
                url.searchParams.set('tag', tag.dataset.tag);
            }
            window.history.pushState({}, '', url);

            filterPosts(searchInput.value.toLowerCase(), currentCategory);
        });
    });

    function filterPosts(term, category) {
        filteredPosts = allPosts.filter(post => {
            const matchesSearch = !term || 
                                  post.title.toLowerCase().includes(term) || 
                                  post.tags.toLowerCase().includes(term) ||
                                  post.excerpt.toLowerCase().includes(term);
            const matchesCategory = category === 'all' || post.tags.toLowerCase().includes(category);
            
            return matchesSearch && matchesCategory;
        });

        // Reset grid and index
        grid.innerHTML = '';
        currentIndex = 0;
        
        if (filteredPosts.length === 0) {
            grid.innerHTML = '<div class="no-results"><p>No articles found matching your criteria.</p><button class="btn btn-outline mt-lg" id="clear-search">Clear Search</button></div>';
            document.getElementById('clear-search').addEventListener('click', () => {
                searchInput.value = '';
                filterTags[0].click(); // Reset to 'All'
            });
            spinner.classList.remove('visible');
        } else {
            loadMorePosts();
        }
    }
});
</script>
