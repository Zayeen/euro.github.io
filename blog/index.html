---
layout: default
title: Blog
pagination:
  enabled: true
---

<section class="hero">
    <div class="status-icons">
        <div class="status-icon-box active">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
        </div>
    </div>
    <h1>The <span class="text-teal">Knowledge</span> Base</h1>
    <p>In-depth guides, protocol analysis, and hardware breakthroughs from the ConnectedCasa lab.</p>
    
    <div class="search-wrapper">
        <input type="text" id="search-input" placeholder="Search articles..." aria-label="Search">
        
        <div class="view-toggle">
            <button id="grid-view-btn" class="toggle-btn active" title="Grid View">Grid</button>
            <button id="list-view-btn" class="toggle-btn" title="List View">List</button>
        </div>
    </div>
</section>

<section class="blog-section">
    <div class="tags-chips-wrapper">
        <div class="tags-chips-container" id="tags-list">
            <span class="filter-tag active" data-tag="all">All Topics</span>
            
            {% assign all_tags = "" | split: "," %}
            {% for post in site.posts %}
              {% for tag in post.tags %}
                {% capture tag_norm %}{{ tag | downcase }}{% endcapture %}
                {% unless all_tags contains tag_norm %}
                  {% assign all_tags = all_tags | push: tag_norm %}
                {% endunless %}
              {% endfor %}
            {% endfor %}
            {% assign sorted_tags = all_tags | sort %}
            
            {% for tag in sorted_tags %}
            {% assign tag_display = "" %}
            {% assign tag_count = 0 %}
            {% for post in site.posts %}
                {% assign found_in_post = false %}
                {% for t in post.tags %}
                    {% capture t_norm %}{{ t | downcase }}{% endcapture %}
                    {% if t_norm == tag %}
                        {% assign tag_display = t %}
                        {% assign found_in_post = true %}
                    {% endif %}
                {% endfor %}
                {% if found_in_post %}
                    {% assign tag_count = tag_count | plus: 1 %}
                {% endif %}
            {% endfor %}
            <span class="filter-tag" data-tag="{{ tag }}">
                {{ tag_display }} <span class="tag-count">{{ tag_count }}</span>
            </span>
            {% endfor %}
        </div>
    </div>
    
    <div class="posts-grid" id="posts-grid">
        <!-- Posts loaded via JS -->
    </div>

    <div id="loading-sentinel" style="height: 20px; margin: 4rem 0; text-align: center;">
        <div class="loading-spinner"></div>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-input');
    const grid = document.getElementById('posts-grid');
    const filterTags = document.querySelectorAll('.filter-tag');
    const gridBtn = document.getElementById('grid-view-btn');
    const listBtn = document.getElementById('list-view-btn');
    const sentinel = document.getElementById('loading-sentinel');
    const spinner = sentinel.querySelector('.loading-spinner');
    
    let allPosts = [];
    let filteredPosts = [];
    let currentIndex = 0;
    const postsPerPage = 9;

    function setView(view) {
        if (view === 'list') {
            grid.classList.add('list-view');
            listBtn.classList.add('active');
            gridBtn.classList.remove('active');
        } else {
            grid.classList.remove('list-view');
            gridBtn.classList.add('active');
            listBtn.classList.remove('active');
        }
        localStorage.setItem('blog-view', view);
    }

    gridBtn.addEventListener('click', () => setView('grid'));
    listBtn.addEventListener('click', () => setView('list'));
    setView(localStorage.getItem('blog-view') || 'grid');

    // Enable horizontal scroll with mouse wheel for tags
    const tagsContainer = document.getElementById('tags-list');
    if (tagsContainer) {
        tagsContainer.addEventListener('wheel', (e) => {
            if (e.deltaY !== 0) {
                e.preventDefault();
                tagsContainer.scrollLeft += e.deltaY;
            }
        });
    }

    fetch('{{ "/search.json" | relative_url }}')
        .then(response => response.json())
        .then(data => {
            allPosts = data;
            const urlParams = new URLSearchParams(window.location.search);
            const urlTag = urlParams.get('tag');
            
            if (urlTag) {
                const tag = urlTag.toLowerCase();
                filterTags.forEach(t => t.classList.toggle('active', t.dataset.tag.toLowerCase() === tag));
                filterPosts('', tag);
            } else {
                filteredPosts = [...allPosts];
                loadMorePosts();
            }
            setupObserver();
        });

    function loadMorePosts() {
        if (currentIndex >= filteredPosts.length) return;
        spinner.classList.add('visible');
        const nextBatch = filteredPosts.slice(currentIndex, currentIndex + postsPerPage);
        currentIndex += postsPerPage;
        renderPosts(nextBatch);
        spinner.classList.remove('visible');
    }

    function renderPosts(batch) {
        const html = batch.map(post => `
            <article class="card post-card">
                <div class="card-meta">
                    <span class="card-tag">${post.tags.split(',')[0].trim()}</span>
                    <span class="card-date">${post.date}</span>
                </div>
                <h3><a href="${post.url}">${post.title}</a></h3>
                <p>${post.excerpt}</p>
                <a href="${post.url}" class="read-article">
                    Read Article
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
                </a>
            </article>
        `).join('');
        grid.insertAdjacentHTML('beforeend', html);
    }

    function setupObserver() {
        const observer = new IntersectionObserver(entries => {
            if (entries[0].isIntersecting && currentIndex < filteredPosts.length) loadMorePosts();
        });
        observer.observe(sentinel);
    }

    searchInput.addEventListener('input', e => filterPosts(e.target.value.toLowerCase(), document.querySelector('.filter-tag.active').dataset.tag));

    filterTags.forEach(tag => {
        tag.addEventListener('click', () => {
            filterTags.forEach(t => t.classList.remove('active'));
            tag.classList.add('active');
            filterPosts(searchInput.value.toLowerCase(), tag.dataset.tag.toLowerCase());
        });
    });

    function filterPosts(term, category) {
        filteredPosts = allPosts.filter(post => {
            const matchesSearch = !term || post.title.toLowerCase().includes(term) || post.excerpt.toLowerCase().includes(term);
            const matchesCategory = category === 'all' || post.tags.toLowerCase().includes(category);
            return matchesSearch && matchesCategory;
        });
        grid.innerHTML = '';
        currentIndex = 0;
        if (filteredPosts.length === 0) {
            grid.innerHTML = '<div class="no-results">No articles found matching your criteria.</div>';
        } else {
            loadMorePosts();
        }
    }
});
</script>
